# Walkthrough: Mobile Navigation Fix

**Date:** January 23, 2026

---

## Root Cause
**Class F Bug: Event propagation race condition**

[handleClickOutside](file:///home/project/authentic-kopitiam/frontend/src/components/layout/header.tsx#41-58) was closing the menu immediately after the toggle button opened it, because button click bubbled to document.

---

## Changes Made

### 1. header.tsx - Fixed Click Handler
**Lines 41-57:**
```diff
const handleClickOutside = (e: MouseEvent) => {
  const target = e.target as HTMLElement;
  const mobileMenu = document.getElementById('mobile-menu');
+ const menuToggle = document.querySelector('.menu-toggle');
+ const cartBtn = document.querySelector('.cart-btn');
  const cartOverlay = document.getElementById('cart-overlay');

- if (mobileMenu && !mobileMenu.contains(target)) {
+ if (mobileMenu && !mobileMenu.contains(target) && !menuToggle?.contains(target)) {
    setIsMobileMenuOpen(false);
  }
```

### 2. globals.css - Added Mobile Menu Styles (lines 544-605)
- `.mobile-menu` base styles
- `.mobile-menu.is-open` transform toggle
- `.mobile-menu__close` and `.mobile-menu__link` styling

### 3. mobile-menu.tsx - Refactored
- Inline styles → CSS class toggle (`is-open`)
- Hash URLs → Route URLs (`/menu`, `/heritage`)

---

## Verification

| Check | Result |
|-------|--------|
| Build | ✅ Exit code 0 |
| 13/13 pages generated | ✅ |

---

## Test Instructions

```bash
cd frontend && npm run dev
# Open http://localhost:3000 in mobile view (390×844)
# Click hamburger menu → should slide in
# Click outside menu → should close
# Click hamburger again → should open again
```
